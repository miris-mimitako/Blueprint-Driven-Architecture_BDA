# /bda-init - 新規Context/Feature初期化

新しいBounded ContextまたはFeatureの雛形ファイルを生成します。

## 引数

```
/bda-init context {context_name}
/bda-init feature {feature_name} --context {context_name}
```

## Context 初期化

### 実行例

```
/bda-init context identity
```

### 生成されるファイル

```
design/contexts/identity/
├── main.yaml
├── domain.yaml
└── application.yaml
```

### 生成内容

#### main.yaml

```yaml
name: {ContextName}Context
description: "{Context説明 - ユーザーに確認}"

domain:
  $ref: "./domain.yaml"
  note: "Aggregates, Events, Domain Services, Repository Interfaces"

application:
  $ref: "./application.yaml"
  note: "UseCases, Queries, Event Handlers"
```

#### domain.yaml

```yaml
# {ContextName}Context - Domain Layer
# Generated by /bda-init

aggregates:
  - name: {AggregateRoot}
    root: true
    properties:
      - { name: id, type: "{AggregateRoot}Id" }
      # TODO: Add properties
    behaviors:
      # TODO: Add behaviors
      # - { name: actionName, emits: EventName, desc: "説明" }

events:
  # TODO: Define domain events
  # - name: {AggregateRoot}Created
  #   properties: { id: "{AggregateRoot}Id", occurredAt: DateTime }

repositories:
  - name: "{AggregateRoot}Repository"
    methods:
      - { name: save, input: "{AggregateRoot}", output: "{AggregateRoot}" }
      - { name: findById, input: "{AggregateRoot}Id", output: "{AggregateRoot}?" }

# services:
#   - name: "{ServiceName}Service"
#     desc: "複数Aggregate間のビジネスルール"
#     methods:
#       - { name: methodName, input: InputType, output: OutputType }
```

#### application.yaml

```yaml
# {ContextName}Context - Application Layer
# Generated by /bda-init

useCases:
  - name: "Create{AggregateRoot}"
    input: { /* TODO: Define input */ }
    output: "{AggregateRoot}DTO"
    flow: "Factory.create -> Repo.save"

  # TODO: Add more use cases
  # - name: "Update{AggregateRoot}"
  #   input: { id: "{AggregateRoot}Id", /* fields */ }
  #   output: "{AggregateRoot}DTO"
  #   flow: "Repo.find -> {AggregateRoot}.update() -> Repo.save"

queries:
  # TODO: Define queries (CQRS read side)
  # - name: "Get{AggregateRoot}List"
  #   input: { /* filter params */ }
  #   output: "List<{AggregateRoot}DTO>"
  #   strategy: "Direct SQL / Read Replica"

# eventHandlers:
#   - name: "Handle{ExternalEvent}"
#     trigger: "Event: {OtherContext}.{EventName}"
#     flow: "Process event -> Update local state"
```

### 実行フロー

1. Context名を受け取る
2. Aggregate Root名を質問（デフォルト: Context名から推測）
3. 簡単な説明を質問
4. 上記テンプレートでファイル生成
5. `blueprint.yaml` の `contexts:` に `$ref` を追加（確認後）

---

## Feature 初期化 (Frontend)

### 実行例

```
/bda-init feature settings --context identity
```

### 生成されるファイル

```
design/interfaces/frontend/settings.yaml
```

### 生成内容

```yaml
# {FeatureName} Feature
# Generated by /bda-init

id: "{FeatureName}Feature"
name: "{FeatureName}Page"
path: "/{feature-path}"

state:
  # TODO: Define view state
  - { name: isLoading, type: Boolean, default: false }
  - { name: error, type: "String?", default: null }
  # - { name: data, type: "List<ItemDTO>", default: [] }

inputs:
  # TODO: Define user actions
  # - { name: onSubmit, args: [{ name: data, type: FormData }] }
  # - { name: onCancel, args: [] }

scenarios:
  - name: "Initial Load"
    given: { state: { isLoading: true } }
    when: "Page mounted"
    then: { state: { isLoading: false, /* data loaded */ } }

  # TODO: Add more scenarios
  # - name: "Submit Form"
  #   given: { state: { /* initial state */ } }
  #   when: "User clicks submit"
  #   then: { sideEffects: ["API call"], state: { /* updated */ } }
```

### 実行フロー

1. Feature名とContext名を受け取る
2. パス（URL）を質問
3. テンプレートでファイル生成
4. `blueprint.yaml` の `interfaces.frontend.features:` に追加（確認後）

---

## よく使うContext雛形

### Identity (認証)

```
/bda-init context identity
```

推奨Aggregate: `User`
推奨UseCases: `RegisterUser`, `Login`, `ChangePassword`

### Notification (通知)

```
/bda-init context notification
```

推奨Aggregate: `Notification`
推奨UseCases: `SendNotification`, `MarkAsRead`

---

## オプション

| Option | Description |
|--------|-------------|
| `--dry-run` | ファイルを生成せず、プレビューのみ表示 |
| `--force` | 既存ファイルを上書き |
| `--no-blueprint` | blueprint.yamlへの追加をスキップ |
