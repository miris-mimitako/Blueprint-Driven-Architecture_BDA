# IdentityContext - Domain Layer
# Generated by /bda-init

aggregates:
  - name: User
    root: true
    properties:
      - { name: id, type: UserId }
      - { name: email, type: Email }
      - { name: passwordHash, type: String }
      - { name: isActive, type: Boolean, default: true }
      - { name: createdAt, type: DateTime }
    behaviors:
      - { name: register, emits: UserRegistered, desc: "新規ユーザー登録" }
      - { name: changePassword, args: [newPasswordHash], desc: "パスワード変更" }
      - { name: deactivate, emits: UserDeleted, desc: "アカウント無効化" }

events:
  - name: UserRegistered
    properties:
      userId: UserId
      email: String
      occurredAt: DateTime

  - name: UserDeleted
    properties:
      userId: UserId
      occurredAt: DateTime

repositories:
  - name: UserRepository
    methods:
      - { name: save, input: User, output: User }
      - { name: findById, input: UserId, output: "User?" }
      - { name: findByEmail, input: Email, output: "User?" }

services:
  - name: PasswordHashService
    desc: "パスワードのハッシュ化と検証を行うドメインサービス"
    methods:
      - { name: hash, input: String, output: String }
      - { name: verify, input: [plainPassword, hashedPassword], output: Boolean }

  - name: EmailUniquenessService
    desc: "メールアドレスの一意性を保証するドメインサービス"
    methods:
      - { name: isUnique, input: Email, output: Boolean }
