# IdentityContext - Application Layer
# Generated by /bda-init

useCases:
  - name: RegisterUser
    input:
      email: String
      password: String
    output: UserDTO
    flow: |
      1. EmailUniquenessService.isUnique(email)
      2. PasswordHashService.hash(password)
      3. User.register(email, hashedPassword)
      4. UserRepository.save(user)
      5. EventPublisher.publish(UserRegistered)

  - name: Login
    input:
      email: String
      password: String
    output: AuthTokenDTO
    flow: |
      1. UserRepository.findByEmail(email)
      2. PasswordHashService.verify(password, user.passwordHash)
      3. JwtService.generateToken(user)

  - name: ChangePassword
    input:
      userId: UserId
      currentPassword: String
      newPassword: String
    output: Void
    flow: |
      1. UserRepository.findById(userId)
      2. PasswordHashService.verify(currentPassword, user.passwordHash)
      3. User.changePassword(newHashedPassword)
      4. UserRepository.save(user)

  - name: DeactivateUser
    input:
      userId: UserId
    output: Void
    flow: |
      1. UserRepository.findById(userId)
      2. User.deactivate()
      3. UserRepository.save(user)
      4. EventPublisher.publish(UserDeleted)

queries:
  - name: GetUserProfile
    desc: "ユーザープロフィール情報を取得"
    input: { userId: UserId }
    output: UserProfileDTO
    strategy: "Direct Query"

  - name: GetUserByEmail
    desc: "メールアドレスでユーザーを検索（重複チェック用）"
    input: { email: Email }
    output: "UserDTO?"
    strategy: "Direct Query"
